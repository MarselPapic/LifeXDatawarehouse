<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>LifeX ‚Äì UI Inventory (Screenshot Helper)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* =================== Base / Tokens =================== */
    :root{
      --brand:#003a70;
      --primary:#0067c2;
      --primary-hover:#0054a6;
      --text:#111;
      --muted:#555;
      --border:#ccc;
      --border-soft:#ddd;
      --bg:#f5f7fb;
      --panel:#e9f1ff;
      --panel-border:#cfe0ff;
      --ok:#1e8e3e;
      --err:#c5221f;
      --card-shadow:0 2px 6px rgba(0,0,0,.1);
      --radius:12px;
      --btn-radius:8px;
      --stage-w:900px;
      --stage-h:560px;
      --max-page-w:2560px;
      /* Komponentenskalierung */
      --ui-scale: 1; /* 1 = 100 % */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Arial,Helvetica,sans-serif;color:var(--text);background:var(--bg)}
    h1,h2,h3{margin:.2rem 0 .6rem}
    p{margin:.2rem 0 .8rem}
    small{color:var(--muted)}
    code{background:#f1f3f9;border:1px solid #e6e8ef;border-radius:4px;padding:0 .25rem}

    /* =================== Header =================== */
    header{position:sticky;top:0;z-index:4;background:var(--brand);color:#fff;
      display:flex;align-items:center;gap:.75rem;padding:.45rem 1rem}
    header .menu-toggle{all:unset;cursor:pointer;font-size:1.2rem;line-height:1;padding:.25rem .4rem;border-radius:6px}
    header .menu-toggle:hover{background:rgba(255,255,255,.12)}
    header .title{font-weight:bold;font-size:1.05rem;letter-spacing:.2px}
    header .badge{margin-left:auto;font-size:.9rem;opacity:.9}

    /* =================== Layout =================== */
    .layout{max-width:100%;margin:1rem auto;display:grid;grid-template-columns:320px 1fr;gap:1rem;padding:0 1rem;transition:grid-template-columns .2s ease}
    body.collapsed .layout{grid-template-columns:0 1fr}

    .sidebar{background:#fff;border-radius:var(--radius);box-shadow:var(--card-shadow);padding:1rem;height:calc(100vh - 110px);
      position:sticky;top:70px;overflow:auto;transition:padding .2s ease, width .2s ease, opacity .15s}
    body.collapsed .sidebar{padding:0;width:0;opacity:0;overflow:hidden;border:0;box-shadow:none}

    .stage-wrap{display:flex;align-items:center;justify-content:center;min-height:calc(100vh - 110px)}
    .stage-wrap.fullpage{align-items:flex-start;justify-content:center}

    .stage{background:#fff;border-radius:var(--radius);box-shadow:var(--card-shadow);padding:2rem;
      min-height:var(--stage-h);width:var(--stage-w);
      display:flex;align-items:center;justify-content:center;position:relative;margin:auto;
      transition:min-height .2s ease,width .2s ease, box-shadow .2s ease}
    .stage.grid{background-image:linear-gradient(#f0f2f7 1px,transparent 1px),linear-gradient(90deg,#f0f2f7 1px,transparent 1px);
      background-size:24px 24px; background-position:center center}
    .stage.fullpage{width:100%;max-width:var(--max-page-w)}

    /* Scenes */
    .stage .scene{display:none;width:100%;height:100%}
    .stage .scene.active{display:grid;place-items:center}
    .stage.fullpage .scene.active{display:block;place-items:initial}

    /* Skalierung: aktive Szene-Inhalte werden vergr√∂√üert/verkleinert */
    .stage .scene.active > *{ transform: scale(var(--ui-scale)); transform-origin: center; }

    /* Sidebar nav */
    .search{display:flex;gap:.5rem;margin-bottom:.75rem}
    .search input{flex:1 1 auto;padding:.5rem .6rem;border:1px solid var(--border);border-radius:6px}
    .search button{padding:.5rem .75rem;border:1px solid var(--border);background:#fff;border-radius:6px;cursor:pointer}
    .menu{display:flex;flex-direction:column;gap:.25rem}
    .menu h4{margin:.8rem 0 .2rem;color:var(--muted);font-weight:bold;font-size:.8rem;letter-spacing:.08em;text-transform:uppercase}
    .menu button.item{all:unset;display:block;padding:.45rem .55rem;border-radius:6px;cursor:pointer}
    .menu button.item:hover{background:#f5f7fb}
    .menu button.item.active{background:var(--panel);border:1px solid var(--panel-border)}
    .menu .item small{display:block;color:var(--muted)}

    /* Quick-Open */
    .quickopen{margin:.6rem 0 0;padding:.6rem;border:1px solid var(--border);border-radius:8px;background:#fcfdff}
    .quickopen label{display:block;font-weight:bold;margin-bottom:.35rem}
    .qo-row{display:flex;gap:.4rem}
    .quickopen select,.quickopen input{flex:1;padding:.4rem;border:1px solid var(--border);border-radius:6px}
    .quickopen button{padding:.45rem .8rem;border:1px solid var(--border);border-radius:6px;background:#fff;cursor:pointer}
    .quickopen small{display:block;margin-top:.4rem;color:#666}

    /* Toolbar (fixiert) */
    .toolbar{position:fixed;top:68px;left:calc(320px + 24px);right:16px;background:#fff;border:1px solid var(--border);border-radius:10px;
      box-shadow:var(--card-shadow);padding:.4rem .5rem;display:flex;align-items:center;gap:.5rem;flex-wrap:wrap;z-index:9999;pointer-events:none}
    .toolbar > *{pointer-events:auto}
    body.collapsed .toolbar{left:16px}
    @media (max-width:1100px){ .toolbar{left:16px} }

    .toolbar label{display:flex;align-items:center;gap:.3rem;font-size:.9rem;color:#333}
    .toolbar input[type="range"]{width:120px}
    .toolbar .sep{width:1px;height:18px;background:#e6e6e6;margin:0 .25rem}
    .toolbar .shot{border:1px solid var(--border);border-radius:8px;padding:.35rem .6rem;background:#fafbfd;cursor:pointer}
    .toolbar .shot:hover{background:#eef2fb}
    .toolbar select{padding:.2rem .35rem;border:1px solid var(--border);border-radius:6px;background:#fff}
    .toolbar input[type="number"]{width:90px;padding:.2rem .35rem;border:1px solid var(--border);border-radius:6px}
    .previewOnly{display:none}

    /* Fixpunkt-Skala */
    .scale-group{display:flex;gap:.25rem}
    .scale-group button{border:1px solid var(--border);background:#fff;border-radius:6px;padding:.25rem .45rem;cursor:pointer;font-weight:600}
    .scale-group button.active{background:var(--brand);color:#fff;border-color:var(--brand)}

    /* Components */
    .btn{display:inline-flex;align-items:center;gap:.5rem;border-radius:var(--btn-radius);padding:.5rem 1rem;border:1px solid transparent;line-height:1.2;cursor:pointer;font-weight:600}
    .btn-primary{background:var(--primary);color:#fff}
    .btn-primary:hover,.sim-hover .btn-primary{background:var(--primary-hover)}
    .btn-primary:disabled,.sim-disabled .btn-primary{opacity:.6;cursor:not-allowed}
    .btn-secondary{background:#f6f7fb;color:#0f172a;border:1px solid var(--border)}
    .btn-secondary:hover,.sim-hover .btn-secondary{background:#eef1f8}
    .btn-link{background:transparent;color:#brand;border:0;padding:0;font-weight:bold}
    .btn-link:hover,.sim-hover .btn-link{color:var(--primary-hover);text-decoration:underline}

    a#back{display:inline-block;color:#fff;background:var(--brand);text-decoration:none;font-weight:bold;padding:.6rem 1rem;border-radius:8px}
    a#back:hover,.sim-hover a#back{background:var(--primary-hover)}

    .input{padding:.6rem .7rem;border:1px solid var(--border);border-radius:8px;width:100%}
    .input:focus,.sim-focus .input{outline:3px solid #cde1ff;border-color:#7fb4ff}
    .select{padding:.6rem .7rem;border:1px solid var(--border);border-radius:8px;min-width:260px;background:#fff}
    .field{display:flex;flex-direction:column;gap:.25rem;margin-bottom:.9rem}
    .field label{font-weight:bold}
    .pill{display:inline-flex;align-items:center;gap:.4rem;background:var(--panel);border:1px solid var(--panel-border);padding:.25rem .6rem;border-radius:999px;font-size:.9rem}
    .card{background:#fff;padding:1.4rem;border-radius:var(--radius);max-width:730px;margin:auto;box-shadow:var(--card-shadow)}
    .page-card{background:#fff;padding:0;border-radius:var(--radius);box-shadow:var(--card-shadow);max-width:none;width:100%;margin:0}
    .panel{background:var(--panel);border:1px solid var(--panel-border);border-radius:8px;padding:.9rem}
    .panel input{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}

    /* Progress bar */
    #idx-box{border:1px dashed var(--border);border-radius:10px;padding:1rem;width:100%}
    #idx-bar{height:16px;background:#eef3ff;border:1px solid var(--panel-border);border-radius:999px;overflow:hidden}
    #idx-bar span{display:block;height:100%;width:35%;background:linear-gradient(90deg,var(--primary) 0%,#4f8dd9 100%)}

    /* Tables */
    .table-scroll{overflow-x:auto;width:100%}
    table{border-collapse:collapse;width:100%;min-width:650px}
    th,td{border:1px solid var(--border);padding:.6rem;text-align:left}
    th{background:#f6f8fc}
    tr:hover td{background:#fafcff}
    #kv{border-collapse:collapse;width:100%}
    #kv td{border:1px solid var(--border-soft);padding:.6rem}
    #kv td.key{font-weight:bold;width:180px;background:#f3f7ff}

    /* ============== Screenshot Mode ============== */
    body.shot header{display:none}
    body.shot .layout{max-width:none;width:100%;padding:0;gap:0;display:flex;justify-content:center}
    body.shot .sidebar{display:none}
    body.shot .stage{ box-shadow:0 0 0 1px rgba(0,0,0,.06),0 12px 40px rgba(0,0,0,.18) }
    body.shot .toolbar{display:none}
    body.shot .stage-wrap{min-height:100vh;padding:2rem;display:flex;align-items:center;justify-content:center}
    body.shot .stage{margin:0}
    body.shot{background:#e9eef7}
    .shot-banner{position:fixed;top:10px;left:50%;transform:translateX(-50%);background:#0f172a;color:#fff;padding:.35rem .6rem;border-radius:8px;box-shadow:var(--card-shadow);z-index:9999;font-size:.9rem;opacity:.9;display:flex;align-items:center;gap:.6rem}
    .shot-banner button{border:1px solid #3b4151;background:#1f2633;color:#fff;border-radius:6px;padding:.25rem .5rem;cursor:pointer}

    /* Page preview scaling */
    .frame-outer{flex:1;min-height:480px;border:1px solid var(--border);border-radius:10px;overflow:hidden;background:#fff;display:flex;justify-content:center;align-items:flex-start}
    .frame-scale{transform-origin:top center}
    .page-frame{width:100%;height:100%;border:0;background:#fff}
  </style>
</head>
<body>
<header>
  <button class="menu-toggle" id="toggleMenu" title="Sidebar ein-/ausblenden">‚ò∞</button>
  <div class="title">LifeX UI Inventory</div>
  <div class="badge">Screenshot-Helfer ‚Ä¢ Komponentenkatalog</div>
</header>
<div id="shotBanner" class="shot-banner" style="display:none">
  <span>Shot-Layout aktiv ‚Äì Taste <strong>F</strong> oder Button zum Beenden</span>
  <button id="shotExitBtn">Beenden</button>
</div>

<div class="layout">
  <!-- =================== Sidebar =================== -->
  <aside class="sidebar">
    <div class="search">
      <input id="filter" placeholder="Komponente filtern ‚Ä¶" />
      <button id="clearFilter" title="Filter l√∂schen">‚úï</button>
    </div>
    <nav class="menu" id="menu">
      <h4>Buttons</h4>
      <button class="item" data-target="btn-primary"><strong>Prim√§rer Button</strong><small>Hauptaktion</small></button>
      <button class="item" data-target="btn-secondary"><strong>Sekund√§rer Button</strong><small>Standard</small></button>
      <button class="item" data-target="btn-back"><strong>Zur√ºck-Link</strong><small>Button-Stil</small></button>

      <h4>Shortcuts & Panels</h4>
      <button class="item" data-target="shortcut-closed"><strong>Shortcut ‚Äì geschlossen</strong><small>Akkordeon-Kopf</small></button>
      <button class="item" data-target="shortcut-open"><strong>Shortcut ‚Äì offen</strong><small>mit Panel-Input</small></button>
      <button class="item" data-target="panel-input"><strong>Panel-Input</strong><small>Monospace</small></button>

      <h4>Suche</h4>
      <button class="item" data-target="searchbar"><strong>Suchfeld + Vorschl√§ge</strong><small>mit Button</small></button>
      <button class="item" data-target="progress"><strong>Reindex-Fortschritt</strong><small>Progress-Bar</small></button>

      <h4>Tabellen</h4>
      <button class="item" data-target="result-table"><strong>Ergebnis-Tabelle</strong><small>Suchresultate</small></button>
      <button class="item" data-target="table-viewer"><strong>Tabellen-Viewer</strong><small>100-Zeilen-Preview</small></button>
      <button class="item" data-target="kv-table"><strong>Key-Value Tabelle</strong><small>Details</small></button>

      <h4>Formulare</h4>
      <button class="item" data-target="entity-select"><strong>Entit√§tsauswahl</strong><small>select#entity</small></button>
      <button class="item" data-target="project-form"><strong>Form ‚ÄûProject‚Äú</strong><small>Text/Number/Boolean</small></button>

      <h4>Feedback</h4>
      <button class="item" data-target="alert-ok"><strong>Success-Meldung</strong><small>.success</small></button>
      <button class="item" data-target="alert-err"><strong>Error-Meldung</strong><small>.error</small></button>

      <h4>Chips</h4>
      <button class="item" data-target="pills"><strong>Pills</strong><small>verlinkte Chips</small></button>

      <h4>Seiten (Full Page)</h4>
      <button class="item" data-target="page-index"><strong>Index ‚Äì ganze Seite</strong><small>/index.html</small></button>
      <button class="item" data-target="page-details"><strong>Details ‚Äì ganze Seite</strong><small>/details.html</small></button>
      <button class="item" data-target="page-create"><strong>Create ‚Äì ganze Seite</strong><small>/create.html</small></button>

      <!-- Schnell-Auswahl f√ºr Details -->
      <div class="quickopen" id="quickOpen">
        <label>Details √∂ffnen</label>
        <div class="qo-row">
          <select id="qoType">
            <option value="account">Account</option>
            <option value="project">Project</option>
            <option value="site">Site</option>
            <option value="server">Server</option>
            <option value="client">Client</option>
            <option value="radio">Radio</option>
            <option value="audio">Audio</option>
            <option value="phone">Phone</option>
          </select>
          <input id="qoId" inputmode="numeric" placeholder="ID">
          <button id="qoOpenBtn" title="√ñffnen">√ñffnen</button>
        </div>
        <small>L√§dt automatisch <code>/details.html?type=‚Ä¶&amp;id=‚Ä¶</code></small>
      </div>
    </nav>
  </aside>

  <!-- =================== Stage =================== -->
  <main class="stage-wrap" id="stageWrap">
    <section class="stage grid" id="stage">
      <!-- Toolbar -->
      <div class="toolbar">
        <label><input type="checkbox" id="toggleGrid" checked> Grid</label>
        <span class="sep"></span>
        <label id="lblHover"><input type="checkbox" id="stateHover"> Hover</label>
        <label id="lblFocus"><input type="checkbox" id="stateFocus"> Fokus</label>
        <label id="lblDisabled"><input type="checkbox" id="stateDisabled"> Disabled</label>
        <span class="sep"></span>
        <label id="lblWidth">Breite
          <input type="range" id="widthRange" min="600" max="1200" step="10" value="900">
        </label>
        <label id="lblHeight">H√∂he
          <input type="range" id="heightRange" min="420" max="900" step="10" value="560">
        </label>
        <!-- Ziel-Element + Textbearbeitung -->
        <label id="lblTarget" style="display:none">Knopf
          <select id="targetSelect"></select>
        </label>
        <label id="lblText" style="display:none">Text
          <input type="text" id="textInput" placeholder="Beschriftung ‚Ä¶">
        </label>
        <!-- Fixpunkt-Skalierung -->
        <div id="scaleCtl" style="display:flex;align-items:center;gap:.35rem"><span>Skalierung</span>
          <div class="scale-group" id="scaleGroup" role="tablist" aria-label="Skalierung">
            <button data-scale="0.6">60%</button>
            <button data-scale="0.8">80%</button>
            <button data-scale="1" class="active">100%</button>
            <button data-scale="1.25">125%</button>
            <button data-scale="1.5">150%</button>
            <button data-scale="1.75">175%</button>
            <button data-scale="2">200%</button>
            <button data-scale="2.25">225%</button>
            <button data-scale="2.5">250%</button>
            <button data-scale="3">300%</button>
            <button data-scale="4">400%</button>
            <button data-scale="5">500%</button>
          </div>
        </div>
        <span class="sep"></span>
        <label id="lblProgress">Progress
          <input type="range" id="progressRange" min="0" max="100" step="1" value="35">
        </label>
        <span class="sep"></span>
        <!-- ==== Screenshot Controls ==== -->
        <label>Gr√∂√üe
          <select id="shotPreset" title="Zielgr√∂√üe f√ºr Screenshot">
            <option value="stage">Stage (Regler)</option>
            <option value="1200x820">1200√ó820 (Shot)</option>
            <option value="1280x720" selected>1280√ó720</option>
            <option value="1600x900">1600√ó900</option>
            <option value="1920x1080">1920√ó1080</option>
            <option value="custom">Benutzerdefiniert‚Ä¶</option>
          </select>
        </label>
        <label id="customSize" style="display:none">
          W <input type="number" id="shotW" min="300" max="4000" step="10" value="1920">
          H <input type="number" id="shotH" min="300" max="4000" step="10" value="1080">
        </label>
        <span class="sep"></span>
        <label class="previewOnly">Vorschau-Zoom
          <input type="range" id="previewZoom" min="50" max="110" step="1" value="90">
        </label>
        <span class="sep previewOnly"></span>

        <button class="shot" id="shotBtn" title="PNG speichern (S)">üì∏ Screenshot</button>
        <button class="shot" id="shotCopy" title="In Zwischenablage kopieren">üìã Kopieren</button>
        <button class="shot" id="shotMode" title="Shot-Layout an/aus">üñºÔ∏è Shot-Layout</button>
      </div>

      <!-- ============ SCENES (one per component) ============ -->
      <div class="scene" id="scene-btn-primary"><button class="btn btn-primary">Neu indexieren</button></div>
      <div class="scene" id="scene-btn-secondary"><button class="btn btn-secondary">Suchen</button></div>
      <div class="scene" id="scene-btn-back"><a id="back" href="index.html">‚Üê zur√ºck</a></div>

      <div class="scene" id="scene-shortcut-closed">
        <div class="card" style="max-width:520px">
          <div class="shortcut">
            <div class="head" style="display:flex;align-items:center;gap:.5rem;cursor:pointer">
              <span class="rename" title="Umbenennen">‚úèÔ∏è</span>
              <span class="label" style="font-weight:600">Gro√üe Projekte</span>
              <span class="chev" style="margin-left:auto">‚ñ∂</span>
            </div>
          </div>
        </div>
      </div>

      <div class="scene" id="scene-shortcut-open">
        <div class="card" style="max-width:520px">
          <div class="shortcut">
            <div class="head" style="display:flex;align-items:center;gap:.5rem;cursor:pointer">
              <span class="rename" title="Umbenennen">‚úèÔ∏è</span>
              <span class="label" style="font-weight:600">Gro√üe Projekte</span>
              <span class="chev" style="margin-left:auto;transform:rotate(90deg)">‚ñ∂</span>
            </div>
            <div class="panel" style="margin-top:.5rem">
              <label class="field">
                <span>Query-Override</span>
                <input class="input" placeholder='type:project AND size:>100GB' value='type:project AND size:>100GB'>
              </label>
            </div>
          </div>
        </div>
      </div>

      <div class="scene" id="scene-panel-input">
        <div class="card" style="max-width:520px">
          <div class="panel">
            <label class="field">
              <span>Query-Override</span>
              <input class="input" placeholder='type:project AND "LifeX"' value='type:project AND "LifeX"'>
            </label>
          </div>
        </div>
      </div>

      <div class="scene" id="scene-searchbar">
        <div style="display:flex;gap:.5rem;align-items:center;width:100%;max-width:780px">
          <input id="search-input" class="input" list="sug" placeholder="Global-Suche (Lucene oder normal)" value="type:project AND Life*">
          <datalist id="sug">
            <option>type:project AND LifeX</option>
            <option>owner:team-data</option>
            <option>status:active AND site:eu</option>
          </datalist>
          <button id="search-btn" class="btn btn-secondary">Suchen</button>
        </div>
      </div>

      <div class="scene" id="scene-progress">
        <div id="idx-box">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:.5rem">
            <strong>Neuindexierung l√§uft ‚Ä¶</strong>
            <small id="progressText">35 %</small>
          </div>
          <div id="idx-bar"><span id="idx-fill" style="width:35%"></span></div>
        </div>
      </div>

      <!-- Tabellen -->
      <div class="scene" id="scene-result-table">
        <div class="table-scroll">
          <table>
            <thead>
            <tr><th>ID</th><th>Name</th><th>Type</th><th>Owner</th><th>Region</th><th>Updated</th></tr>
            </thead>
            <tbody>
            <tr><td>p-1001</td><td>LifeX Onboarding</td><td>project</td><td>team-data</td><td>eu</td><td>2025-07-02</td></tr>
            <tr><td>p-1002</td><td>ETL v2</td><td>project</td><td>engineering</td><td>eu</td><td>2025-06-28</td></tr>
            <tr><td>a-11</td><td>ACME Corp</td><td>account</td><td>sales</td><td>us</td><td>2025-06-11</td></tr>
            <tr><td>s-77</td><td>eu-prod-01</td><td>server</td><td>ops</td><td>eu</td><td>2025-05-30</td></tr>
            <tr><td>p-1099</td><td>Archive Migration</td><td>project</td><td>ops</td><td>apac</td><td>2025-05-12</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="scene" id="scene-table-viewer">
        <div class="table-scroll">
          <table>
            <thead>
            <tr><th>#</th><th>CityName</th><th>PostalCode</th><th>Country</th><th>Notes</th><th>Created</th></tr>
            </thead>
            <tbody>
            <tr><td>1</td><td>Wien</td><td>1010</td><td>AT</td><td>Hauptstadt; UTF-8 ‚úì</td><td>2025-05-01</td></tr>
            <tr><td>2</td><td>Graz</td><td>8010</td><td>AT</td><td>‚Äî</td><td>2025-05-01</td></tr>
            <tr><td>3</td><td>Linz</td><td>4020</td><td>AT</td><td>Lange Beschreibung, die horizontales Scrollen demonstriert ‚Ä¶</td><td>2025-05-01</td></tr>
            <tr><td>4</td><td>Salzburg</td><td>5020</td><td>AT</td><td>‚Äî</td><td>2025-05-01</td></tr>
            <tr><td>5</td><td>Innsbruck</td><td>6020</td><td>‚Äî</td><td>‚Äî</td><td>2025-05-01</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="scene" id="scene-kv-table">
        <div class="card">
          <table id="kv">
            <tbody>
            <tr><td class="key">ProjectID</td><td>p-1001</td></tr>
            <tr><td class="key">Name</td><td>LifeX Onboarding</td></tr>
            <tr><td class="key">Owner</td><td><span class="pill">team-data</span></td></tr>
            <tr><td class="key">Region</td><td><span class="pill">eu</span> <span class="pill">primary</span></td></tr>
            <tr><td class="key">Updated</td><td>2025-07-02 14:21</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Formulare -->
      <div class="scene" id="scene-entity-select">
        <label class="field" style="min-width:280px">
          <span>Entit√§t w√§hlen</span>
          <select class="select" id="entity">
            <option>Account</option>
            <option selected>Project</option>
            <option>Site</option>
            <option>Server</option>
            <option>WorkingPosition</option>
            <option>Radio</option>
            <option>AudioDevice</option>
            <option>PhoneIntegration</option>
            <option>Country</option>
            <option>City</option>
            <option>Address</option>
            <option>DeploymentVariant</option>
            <option>Software</option>
            <option>InstalledSoftware</option>
            <option>UpgradePlan</option>
            <option>ServiceContract</option>
          </select>
        </label>
      </div>

      <div class="scene" id="scene-project-form">
        <form class="card" style="width:100%;max-width:560px">
          <h3>Project anlegen</h3>
          <div class="field">
            <label for="p-name">Project Name</label>
            <input id="p-name" class="input" placeholder="z. B. LifeX Onboarding">
          </div>
          <div class="field">
            <label for="p-owner">Owner</label>
            <input id="p-owner" class="input" placeholder="team-data">
          </div>
          <div class="field">
            <label for="p-size">Estimated Size (GB)</label>
            <input id="p-size" class="input" type="number" value="120">
          </div>
          <div class="field">
            <label for="p-ha">High Availability</label>
            <input id="p-ha" class="input" placeholder="true/false" value="true">
          </div>
          <div style="display:flex;gap:.5rem;margin-top:.6rem">
            <button type="button" class="btn btn-primary">Speichern</button>
            <button type="button" class="btn btn-secondary">Abbrechen</button>
          </div>
          <p class="alert ok" style="margin-top:1rem;display:none" id="ok-msg">Project gespeichert.</p>
          <p class="alert err" style="margin-top:1rem;display:none" id="err-msg">Fehler beim Speichern.</p>
        </form>
      </div>

      <!-- Feedback -->
      <div class="scene" id="scene-alert-ok"><p class="alert ok"><strong>Erfolg:</strong> Operation erfolgreich abgeschlossen.</p></div>
      <div class="scene" id="scene-alert-err"><p class="alert err"><strong>Fehler:</strong> Eingabe ung√ºltig oder Serverfehler.</p></div>

      <!-- Chips -->
      <div class="scene" id="scene-pills">
        <div style="display:flex;gap:.5rem;flex-wrap:wrap">
          <span class="pill">team-data</span><span class="pill">eu</span><span class="pill">primary</span><span class="pill">read-only</span>
        </div>
      </div>

      <!-- ===== Full Page Scenes (iframe-based) ===== -->
      <div class="scene" id="scene-page-index">
        <div class="page-card"><div class="frame-outer"><div class="frame-scale"><iframe class="page-frame" data-url="/index.html"></iframe></div></div></div>
      </div>
      <div class="scene" id="scene-page-details">
        <div class="page-card"><div class="frame-outer"><div class="frame-scale"><iframe class="page-frame" data-url="/details.html"></iframe></div></div></div>
      </div>
      <div class="scene" id="scene-page-create">
        <div class="page-card"><div class="frame-outer"><div class="frame-scale"><iframe class="page-frame" data-url="/create.html"></iframe></div></div></div>
      </div>

    </section>
  </main>
</div>

<!-- html2canvas f√ºr saubere Screenshots -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
  /* ========= Simple router for scenes ========= */
  const map = {
    'btn-primary':'scene-btn-primary',
    'btn-secondary':'scene-btn-secondary',
    'btn-back':'scene-btn-back',
    'shortcut-closed':'scene-shortcut-closed',
    'shortcut-open':'scene-shortcut-open',
    'panel-input':'scene-panel-input',
    'searchbar':'scene-searchbar',
    'progress':'scene-progress',
    'result-table':'scene-result-table',
    'table-viewer':'scene-table-viewer',
    'kv-table':'scene-kv-table',
    'entity-select':'scene-entity-select',
    'project-form':'scene-project-form',
    'alert-ok':'scene-alert-ok',
    'alert-err':'scene-alert-err',
    'pills':'scene-pills',
    'page-index':'scene-page-index',
    'page-details':'scene-page-details',
    'page-create':'scene-page-create',
  };
  const stage = document.getElementById('stage');
  const stageWrap = document.getElementById('stageWrap');
  const scenes = [...stage.querySelectorAll('.scene')];
  const menu = document.getElementById('menu');
  const filter = document.getElementById('filter');
  const clearFilter = document.getElementById('clearFilter');
  const progressRange = document.getElementById('progressRange');
  const progressText = document.getElementById('progressText');
  const idxFill = document.getElementById('idx-fill');
  const toggleMenuBtn = document.getElementById('toggleMenu');
  const heightRange = document.getElementById('heightRange');

  /* ===== Toolbar State Switches ===== */
  const grid = document.getElementById('toggleGrid');
  const hover = document.getElementById('stateHover');
  const focus = document.getElementById('stateFocus');
  const disabled = document.getElementById('stateDisabled');
  const widthRange = document.getElementById('widthRange');

  const lblHover = document.getElementById('lblHover');
  const lblFocus = document.getElementById('lblFocus');
  const lblDisabled = document.getElementById('lblDisabled');
  const lblProgress = document.getElementById('lblProgress');

  // Neue Controls
  const scaleCtl = document.getElementById('scaleCtl');
  const scaleGroup = document.getElementById('scaleGroup');
  const lblTarget = document.getElementById('lblTarget');
  const lblText = document.getElementById('lblText');
  const targetSelect = document.getElementById('targetSelect');
  const textInput = document.getElementById('textInput');

  /* ===== Capability-Matrix pro Szene ===== */
  const CAPS = {
    'scene-btn-primary':      {hover:true,  focus:false, disabled:true,  progress:false},
    'scene-btn-secondary':    {hover:true,  focus:false, disabled:true,  progress:false},
    'scene-btn-back':         {hover:true,  focus:false, disabled:false, progress:false},
    'scene-shortcut-closed':  {hover:true,  focus:false, disabled:false, progress:false},
    'scene-shortcut-open':    {hover:true,  focus:false, disabled:false, progress:false},
    'scene-panel-input':      {hover:false, focus:true,  disabled:false, progress:false},
    'scene-searchbar':        {hover:false, focus:true,  disabled:false, progress:false},
    'scene-progress':         {hover:false, focus:false, disabled:false, progress:true },
    'scene-result-table':     {hover:true,  focus:false, disabled:false, progress:false},
    'scene-table-viewer':     {hover:true,  focus:false, disabled:false, progress:false},
    'scene-kv-table':         {hover:false, focus:false, disabled:false, progress:false},
    'scene-entity-select':    {hover:false, focus:true,  disabled:false, progress:false},
    'scene-project-form':     {hover:false, focus:true,  disabled:false, progress:false},
    'scene-alert-ok':         {hover:false, focus:false, disabled:false, progress:false},
    'scene-alert-err':        {hover:false, focus:false, disabled:false, progress:false},
    'scene-pills':            {hover:true,  focus:false, disabled:false, progress:false},
    'scene-page-index':       {hover:false, focus:false, disabled:false, progress:false, page:true},
    'scene-page-details':     {hover:false, focus:false, disabled:false, progress:false, page:true},
    'scene-page-create':      {hover:false, focus:false, disabled:false, progress:false, page:true},
  };

  function setCtl(labelEl, on, checkbox){
    labelEl.style.display = on ? '' : 'none';
    if(!on && checkbox){ checkbox.checked = false; }
  }

  function applyStates(){
    stage.classList.toggle('grid', grid.checked);
    stage.classList.toggle('sim-hover', hover.checked);
    stage.classList.toggle('sim-focus', focus.checked);
    stage.classList.toggle('sim-disabled', disabled.checked);
  }

  // Fixpunkt-Skalierung
  let lastScale = 1;
  function setScale(f){
    lastScale = f || 1;
    stage.style.setProperty('--ui-scale', String(lastScale));
    if (scaleGroup){
      [...scaleGroup.querySelectorAll('button')].forEach(b=>{
        const s = parseFloat(b.dataset.scale);
        b.classList.toggle('active', Math.abs(s - lastScale) < 0.001);
      });
    }
  }
  if (scaleGroup){
    scaleGroup.addEventListener('click', (e)=>{
      const b = e.target.closest('button'); if(!b) return;
      const val = parseFloat(b.dataset.scale) || 1;
      setScale(val);
    });
  }

  function applyToolbarCaps(sceneId){
    const c = CAPS[sceneId] || {hover:true,focus:true,disabled:true,progress:false};
    setCtl(lblHover,    !!c.hover,    hover);
    setCtl(lblFocus,    !!c.focus,    focus);
    setCtl(lblDisabled, !!c.disabled, disabled);
    setCtl(lblProgress, !!c.progress, progressRange);
    if(!c.progress && progressRange){ progressRange.value = 35; if(idxFill) idxFill.style.width='35%'; if(progressText) progressText.textContent='35 %'; }
    applyStates();

    // Preview-Controls nur f√ºr Full-Page (werden im HTML via .previewOnly markiert)
    document.querySelectorAll('.previewOnly').forEach(n => n.style.display = c.page ? '' : 'none');

    // Skalierung nur f√ºr Komponenten (nicht Full-Page)
    if (scaleCtl){
      if (c.page){
        scaleCtl.style.display = 'none';
        setScale(1);
      } else {
        scaleCtl.style.display = '';
      }
    }
  }

  function isPageId(id){ return /^scene-page-/.test(id); }

  // === Editable Button Text ===
  function getEditableTargets(scene){
    if (!scene) return [];
    return Array.from(scene.querySelectorAll('button, .btn, a#back, a.btn, input[type="button"], input[type="submit"]'));
  }
  function refreshEditableUI(){
    const active = document.querySelector('#stage .scene.active');
    const page = !!(active && /^scene-page-/.test(active?.id||''));
    const targets = (!active || page) ? [] : getEditableTargets(active);
    const has = targets.length > 0;
    if (document.getElementById('lblTarget')) document.getElementById('lblTarget').style.display = has ? '' : 'none';
    if (document.getElementById('lblText')) document.getElementById('lblText').style.display = has ? '' : 'none';
    if (!has) { if (targetSelect) targetSelect.innerHTML=''; if (textInput) textInput.value=''; return; }
    targetSelect._targets = targets;
    targetSelect.innerHTML = '';
    targets.forEach((el, i)=>{
      const label = (el.textContent||el.value||'').trim() || el.id || el.className || el.tagName;
      const opt = document.createElement('option');
      opt.value = String(i);
      opt.textContent = `${i+1}: ${label}`;
      targetSelect.appendChild(opt);
    });
    targetSelect.value = '0';
    const first = targets[0];
    textInput.value = (first.textContent||first.value||'').trim();
  }
  if (targetSelect){
    targetSelect.addEventListener('change', ()=>{
      const i = +targetSelect.value || 0;
      const t = targetSelect._targets?.[i]; if(!t) return;
      textInput.value = (t.textContent||t.value||'').trim();
    });
  }
  if (textInput){
    textInput.addEventListener('input', ()=>{
      const i = +targetSelect.value || 0;
      const t = targetSelect._targets?.[i]; if(!t) return;
      if (t.tagName === 'INPUT') t.value = textInput.value; else t.textContent = textInput.value;
    });
  }

  function activate(id){
    // 1) Szene aktiv schalten
    scenes.forEach(s => s.classList.remove('active'));
    const el = document.getElementById(id);
    if (el){ el.classList.add('active'); }

    // 2) Toolbar-Kapazit√§ten je Szene anwenden
    applyToolbarCaps(id);

    // 2b) Editierbare Ziele aktualisieren
    refreshEditableUI();

    // 3) States + aktives Men√º setzen
    [...menu.querySelectorAll('.item')].forEach(b=>b.classList.remove('active'));
    const btn = [...menu.querySelectorAll('.item')].find(b => map[b.dataset.target] === id);
    if (btn) btn.classList.add('active');

    // 4) Full-Page Modus toggeln (f√ºr iframe-Szenen)
    const pageMode = isPageId(id);
    stageWrap.classList.toggle('fullpage', pageMode);
    stage.classList.toggle('fullpage', pageMode);

    // 5) Page-Defaults einmalig setzen
    if (pageMode && !el.dataset.inited){
      applyPageDefaults(id);
      el.dataset.inited = '1';
    }

    // 6) Seite in iframe laden + Preview fitten
    if (pageMode){
      const frame = el.querySelector('.page-frame');
      if (frame && !frame.dataset.loaded){
        frame.src = frame.dataset.url || '/index.html';
        frame.addEventListener('load', ()=>{ frame.dataset.loaded='1'; fitPagePreview(el); }, {once:true});
      } else if (frame){
        fitPagePreview(el);
      }
    }
  }

  // init menu handlers
  menu.addEventListener('click', (e)=>{
    const b = e.target.closest('button.item');
    if(!b) return;
    activate(map[b.dataset.target]);
  });

  // filter menu
  filter.addEventListener('input', ()=>{
    const q = filter.value.trim().toLowerCase();
    [...menu.querySelectorAll('button.item')].forEach(b => {
      const t = b.innerText.toLowerCase();
      b.style.display = t.includes(q) ? '' : 'none';
    });
  });
  clearFilter.addEventListener('click', ()=>{
    filter.value=''; filter.dispatchEvent(new Event('input')); filter.focus();
  });

  grid.addEventListener('change', applyStates);
  hover.addEventListener('change', applyStates);
  focus.addEventListener('change', applyStates);
  disabled.addEventListener('change', applyStates);

  widthRange.addEventListener('input', ()=>{
    stage.style.setProperty('--stage-w', widthRange.value + 'px');
    updateLivePreview();
  });
  heightRange.addEventListener('input', ()=>{
    stage.style.setProperty('--stage-h', heightRange.value + 'px');
    updateLivePreview();
  });

  if (progressRange){
    progressRange.addEventListener('input', ()=>{
      const v = progressRange.value;
      if (idxFill) idxFill.style.width = v + '%';
      if (progressText) progressText.textContent = v + ' %';
    });
  }

  // Sidebar toggle
  toggleMenuBtn.addEventListener('click', ()=>{
    document.body.classList.toggle('collapsed');
    setTimeout(()=>{ window.dispatchEvent(new Event('resize')); }, 210);
  });

  // ======== Screenshot Helper ========
  const shotBtn = document.getElementById('shotBtn');
  const shotCopy = document.getElementById('shotCopy');
  const shotModeBtn = document.getElementById('shotMode');
  const shotPreset = document.getElementById('shotPreset');
  const customSize = document.getElementById('customSize');
  const shotW = document.getElementById('shotW');
  const shotH = document.getElementById('shotH');
  const shotExitBtn = document.getElementById('shotExitBtn');
  const previewZoom = document.getElementById('previewZoom');

  shotExitBtn.addEventListener('click', ()=>{ document.body.classList.remove('shot'); document.getElementById('shotBanner').style.display='none'; });

  shotPreset.addEventListener('change', ()=>{
    customSize.style.display = (shotPreset.value === 'custom') ? '' : 'none';
    updateLivePreview();
  });
  [shotW, shotH].forEach(el=> el && el.addEventListener('input', updateLivePreview));
  if (previewZoom) previewZoom.addEventListener('input', updateLivePreview);

  function getTargetSize(){
    const v = shotPreset.value;
    if (v === 'stage'){
      return { w: +widthRange.value, h: +heightRange.value };
    }
    if (v === 'custom'){
      return { w: Math.max(300, +shotW.value||1200), h: Math.max(300, +shotH.value||820) };
    }
    const [w,h] = v.split('x').map(Number);
    return { w, h };
  }

  function activeSceneKey(){
    const active = stage.querySelector('.scene.active');
    if (!active) return 'scene';
    const id = active.id || 'scene';
    return id.replace(/^scene-/, '');
  }
  function activeSceneEl(){
    return stage.querySelector('.scene.active') || scenes[0];
  }

  // ======= Filename helpers (NEU) =======
  function deburr(str){
    return (str||'')
            .normalize('NFKD')
            .replace(/[\u0300-\u036f]/g,''); // diacritics
  }
  function slug(str, maxLen=80){
    let s = deburr(String(str))
            .toLowerCase()
            .replace(/&/g,'-and-')
            .replace(/[^a-z0-9]+/g,'-')
            .replace(/^-+|-+$/g,'')
            .replace(/-{2,}/g,'-');
    if (s.length > maxLen) s = s.slice(0, maxLen).replace(/-+$/,'');
    return s || 'na';
  }
  function tsStamp(d=new Date()){
    const pad = n => String(n).padStart(2,'0');
    return `${d.getFullYear()}${pad(d.getMonth()+1)}${pad(d.getDate())}-${pad(d.getHours())}${pad(d.getMinutes())}${pad(d.getSeconds())}`;
  }
  function getStatesList(){
    const states = [];
    if (hover.checked) states.push('hover');
    if (focus.checked) states.push('focus');
    if (disabled.checked) states.push('disabled');
    if (grid.checked) states.push('grid');
    return states;
  }
  function firstText(el){
    return (el?.textContent || el?.value || '').trim();
  }
  function getPrimaryLabelForScene(scene){
    // Bevorzugt: ausgew√§hltes editierbares Target
    const idx = +(targetSelect?.value||0);
    const targets = targetSelect?._targets || getEditableTargets(scene);
    const t = targets?.[idx] || targets?.[0];
    const label = firstText(t);
    if (label) return label;

    // Szenen-spezifisch
    if (scene.id === 'scene-searchbar'){
      const q = document.getElementById('search-input')?.value || '';
      return q ? `query ${q}` : 'searchbar';
    }
    if (scene.id === 'scene-progress'){
      return 'progress';
    }
    return scene.id.replace(/^scene-/,'');
  }

  function collectShotMetaComponent(scene, size){
    const meta = {
      scope: 'component',
      sceneKey: scene.id.replace(/^scene-/,''),
      states: getStatesList(),
      w: size.w, h: size.h,
      scale: lastScale,
      preset: shotPreset?.value || 'custom'
    };

    // Label/Target
    meta.label = getPrimaryLabelForScene(scene);

    // Progress
    if (scene.id === 'scene-progress'){
      const v = parseInt(progressRange?.value || '0', 10);
      meta.progress = isNaN(v) ? undefined : v;
    }

    // Specials
    if (scene.id === 'scene-searchbar'){
      meta.query = document.getElementById('search-input')?.value || '';
      meta.button = firstText(document.getElementById('search-btn'));
    }
    if (scene.id === 'scene-entity-select'){
      const sel = scene.querySelector('select');
      meta.selection = sel ? sel.value || sel.selectedOptions?.[0]?.textContent : '';
    }
    return meta;
  }

  function collectShotMetaPage(scene, size){
    const frame = scene.querySelector('.page-frame');
    const meta = {
      scope: 'page',
      sceneKey: scene.id.replace(/^scene-/,''),
      states: getStatesList(),
      w: size.w, h: size.h,
      scale: 1,
      preset: shotPreset?.value || 'custom'
    };
    try{
      const url = new URL(frame.src, window.location.href);
      meta.urlPath = url.pathname.replace(/^\//,'').replace(/\//g,'-');
      // Enge Auswahl an Query-Parametern (sonst werden Namen zu lang)
      const interesting = [];
      for (const [k,v] of url.searchParams.entries()){
        if (['type','id','q','tab','view'].includes(k)) interesting.push(`${k}-${v}`);
      }
      if (interesting.length) meta.urlParams = interesting.join('-');
      meta.title = frame.contentDocument?.title || '';
    }catch(_){}
    return meta;
  }

  function buildShotFilename(meta){
    const segs = ['lifex', meta.scope];

    segs.push(slug(meta.sceneKey, 40));

    if (meta.title) segs.push(`title-${slug(meta.title, 60)}`);
    if (meta.label) segs.push(`label-${slug(meta.label, 60)}`);
    if (meta.button) segs.push(`btn-${slug(meta.button, 40)}`);
    if (meta.selection) segs.push(`sel-${slug(meta.selection, 40)}`);
    if (meta.query) segs.push(`q-${slug(meta.query, 80)}`);
    if (typeof meta.progress === 'number') segs.push(`progress-${Math.max(0,Math.min(100,Math.round(meta.progress)))}pct`);
    if (meta.urlPath) segs.push(`url-${slug(meta.urlPath, 80)}`);
    if (meta.urlParams) segs.push(slug(meta.urlParams, 80));

    const states = (meta.states||[]).length ? `states-${meta.states.join('-')}` : '';
    if (states) segs.push(states);

    segs.push(`size-${meta.w}x${meta.h}`);
    if (meta.scale && Math.round(meta.scale*100) !== 100){
      segs.push(`scale-${Math.round(meta.scale*100)}pct`);
    }

    const nameCore = segs.join('__');
    const name = `${nameCore}__ts-${tsStamp()}.png`;

    // Hard-Limit f√ºr Dateinamen (Windows/FAT etc. ~255 Zeichen). Wir kappen von hinten.
    return name.length <= 240 ? name : (name.slice(0, 235).replace(/-+$/,'') + '.png');
  }

  async function html2canvasSafe(el, opts){
    if (typeof html2canvas !== 'function') throw new Error('html2canvas nicht geladen');
    await new Promise(r=>setTimeout(r, 40));
    return await html2canvas(el, opts);
  }

  async function takeShot({copy=false}={}){
    try{
      const { w, h } = getTargetSize();
      const scene = activeSceneEl();
      if(!scene) throw new Error('Keine aktive Szene.');

      const wasShot = document.body.classList.contains('shot');
      document.body.classList.add('shot'); // UI ausblenden

      const prevW = stage.style.getPropertyValue('--stage-w');
      const prevH = stage.style.getPropertyValue('--stage-h');
      stage.style.setProperty('--stage-w', w + 'px');
      stage.style.setProperty('--stage-h', h + 'px');

      await new Promise(r=>setTimeout(r, 50));

      const scale = Math.min(3, (window.devicePixelRatio || 1));
      const canvas = await html2canvasSafe(stage, {
        backgroundColor:'#fff',
        scale,
        useCORS:true,
        foreignObjectRendering:false,
        allowTaint:true,
      });

      if (prevW) stage.style.setProperty('--stage-w', prevW); else stage.style.removeProperty('--stage-w');
      if (prevH) stage.style.setProperty('--stage-h', prevH); else stage.style.removeProperty('--stage-h');
      if (!wasShot) document.body.classList.remove('shot');

      // ==== Semantische Metadaten + Dateiname (NEU) ====
      const meta = collectShotMetaComponent(scene, {w, h});
      const filename = buildShotFilename(meta);

      canvas.toBlob(async (blob)=>{
        if(!blob) return alert('Konnte PNG nicht erzeugen.');
        if (copy && navigator.clipboard && window.ClipboardItem){
          try{
            await navigator.clipboard.write([ new ClipboardItem({ 'image/png': blob }) ]);
            toast('Screenshot kopiert');
          }catch(err){
            console.warn(err);
            downloadBlob(blob, filename);
            toast('Konnte nicht kopieren ‚Äì PNG gespeichert');
          }
        } else {
          downloadBlob(blob, filename);
          toast('PNG gespeichert');
        }
      }, 'image/png');
    }catch(e){
      console.error(e);
      alert('Screenshot fehlgeschlagen: '+ e.message);
    }
  }

  function downloadBlob(blob, filename){
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = filename; document.body.appendChild(a); a.click();
    a.remove(); URL.revokeObjectURL(url);
  }

  function toast(msg){
    const t = document.createElement('div');
    t.textContent = msg;
    t.style.cssText = 'position:fixed;bottom:18px;left:50%;transform:translateX(-50%);background:#111;color:#fff;padding:.45rem .7rem;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,.25);z-index:99999;font-size:.9rem';
    document.body.appendChild(t);
    setTimeout(()=>{ t.style.transition="opacity .3s"; t.style.opacity="0"; setTimeout(()=>t.remove(), 320); }, 1000);
  }

  // ===== Full-Page: Vorschau + Screenshot =====
  const pageDefaults = {
    'scene-page-index':   { preset: '1280x720', zoom: 90 },
    'scene-page-details': { preset: '1280x720', zoom: 100 },
    'scene-page-create':  { preset: '1280x720', zoom: 95 }
  };
  function applyPageDefaults(id){
    const d = pageDefaults[id];
    if (!d) return;
    if (shotPreset) shotPreset.value = d.preset;
    if (previewZoom) previewZoom.value = d.zoom;
    updateLivePreview();
  }

  const shotBannerEl = document.getElementById('shotBanner');

  shotBtn.addEventListener('click', ()=> (isActivePage() ? takePageShot() : takeShot()));
  shotCopy.addEventListener('click', ()=> (isActivePage() ? takePageShot({copy:true}) : takeShot({copy:true})));
  shotModeBtn.addEventListener('click', ()=>{
    document.body.classList.toggle('shot');
    if (shotBannerEl) shotBannerEl.style.display = document.body.classList.contains('shot') ? '' : 'none';
  });

  document.addEventListener('keydown', (e)=>{
    const tag = (e.target?.tagName||'').toLowerCase();
    const typing = ['input','textarea','select'].includes(tag);
    const key = (e.key||'').toLowerCase();
    if (!typing && !e.ctrlKey && !e.metaKey && key==='s'){ e.preventDefault(); takeShot(); }
    if (!typing && !e.ctrlKey && !e.metaKey && key==='f'){ e.preventDefault(); shotModeBtn.click(); }
  });

  function isActivePage(){
    const active = document.querySelector('#stage .scene.active');
    return !!(active && /^scene-page-/.test(active.id));
  }

  function measureDocHeight(doc){
    const b = doc.body; const e = doc.documentElement;
    return Math.max(b.scrollHeight, e.scrollHeight, b.offsetHeight, e.offsetHeight, b.clientHeight, e.clientHeight);
  }

  async function ensureHtml2CanvasIn(win){
    if (win.html2canvas) return;
    await new Promise((resolve, reject)=>{
      const s = win.document.createElement('script');
      s.src = 'https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js';
      s.onload = resolve; s.onerror = reject;
      win.document.head.appendChild(s);
    });
  }

  function fitPagePreview(scene){
    const outer = scene.querySelector('.frame-outer');
    const scaleWrap = scene.querySelector('.frame-scale');
    const frame = scene.querySelector('.page-frame');
    if (!outer || !scaleWrap || !frame) return;

    const { w, h } = getTargetSize();
    frame.style.width = w + 'px';

    let targetH = h || 820;
    try {
      const doc = frame.contentDocument;
      const fullH = measureDocHeight(doc);
      frame.style.height = fullH + 'px';
      targetH = (shotPreset.value === 'stage')
              ? +document.getElementById('heightRange').value
              : (shotPreset.value === 'custom' ? (+shotH.value || fullH) : fullH);
    } catch (e) {
      frame.style.height = targetH + 'px';
    }

    scaleWrap.style.width = w + 'px';
    scaleWrap.style.height = targetH + 'px';

    const avail = (outer.clientWidth || stage.clientWidth) - 24;
    const zoom = previewZoom ? Math.max(50, Math.min(110, +previewZoom.value)) / 100 : 1;
    const scale = Math.min(1, avail / w) * zoom;
    scaleWrap.style.transform = `scale(${scale})`;

    outer.style.height = Math.ceil(scaleWrap.clientHeight * scale) + 'px';
  }

  function updateLivePreview(){
    const active = document.querySelector('#stage .scene.active');
    if (active && /^scene-page-/.test(active.id)) fitPagePreview(active);
  }
  window.addEventListener('resize', updateLivePreview);

  async function takePageShot({copy=false}={}){
    try{
      const active = document.querySelector('#stage .scene.active');
      if (!active || !/^scene-page-/.test(active.id)) return takeShot({copy});
      const frame = active.querySelector('.page-frame');
      const win = frame.contentWindow; const doc = frame.contentDocument;
      await ensureHtml2CanvasIn(win);

      const { w, h } = getTargetSize();
      let totalH = h || 820;
      try{
        const autoH = measureDocHeight(doc);
        totalH = autoH; frame.style.height = autoH + 'px';
      }catch(_){ }

      frame.style.width = w + 'px';
      await new Promise(r=>setTimeout(r, 50));

      const scale = Math.min(3, (window.devicePixelRatio||1));
      const canvas = await win.html2canvas(doc.body, {
        backgroundColor:'#fff', scale, width:w, height:totalH,
        windowWidth:w, windowHeight:totalH, scrollX:0, scrollY:0, useCORS:true
      });

      // ==== Metadaten + Dateiname (NEU) ====
      const meta = collectShotMetaPage(active, {w, h: totalH});
      const filename = buildShotFilename(meta);

      canvas.toBlob(async (blob)=>{
        if(!blob) return alert('Konnte PNG nicht erzeugen.');
        if (copy && navigator.clipboard && window.ClipboardItem){
          try{ await navigator.clipboard.write([ new ClipboardItem({ 'image/png': blob }) ]); toast('Screenshot kopiert'); }
          catch(err){ console.warn(err); downloadBlob(blob,filename); toast('Konnte nicht kopieren ‚Äì PNG gespeichert'); }
        } else { downloadBlob(blob, filename); toast('PNG gespeichert'); }
      }, 'image/png');
    }catch(e){ console.error(e); alert('Page-Screenshot fehlgeschlagen: '+ e.message); }
  }

  document.addEventListener('DOMContentLoaded', updateLivePreview);

  // === QuickOpen: √∂ffnet Details direkt ===
  const qoType = document.getElementById('qoType');
  const qoId = document.getElementById('qoId');
  const qoOpenBtn = document.getElementById('qoOpenBtn');
  function quickOpenDetails(){
    const type = qoType.value;
    const id = qoId.value.trim();
    if(!id) { qoId.focus(); return; }
    const sceneId = 'scene-page-details';
    activate(sceneId);
    const scene = document.getElementById(sceneId);
    const frame = scene.querySelector('.page-frame');
    const base = (frame.dataset.url||'/details.html');
    const url = `${base}?type=${encodeURIComponent(type)}&id=${encodeURIComponent(id)}`;
    frame.dataset.loaded='';
    frame.src = url;
    frame.addEventListener('load', ()=>{ frame.dataset.loaded='1'; fitPagePreview(scene); }, {once:true});
    stage.scrollIntoView({behavior:'smooth',block:'start'});
  }
  qoOpenBtn.addEventListener('click', quickOpenDetails);
  qoId.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); quickOpenDetails(); } });

  // default Szene + Skalierung
  activate('scene-btn-primary');
  setScale(1);
</script>


</body>
</html>
